name: Lint

on:
  push:
    branches:
      - master
  pull_request:

permissions:
  contents: read

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4

      - name: Bash syntax check
        run: bash -n atlas-install.sh

      - name: Install ShellCheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck

      - name: Run ShellCheck
        run: shellcheck -x -s bash -e SC1090,SC1091,SC2015,SC2034,SC2059,SC2094,SC2129,SC2154,SC2155,SC2295,SC2318 atlas-install.sh

      - name: Validate VERSION file
        run: |
          if [ ! -f VERSION ]; then
            echo "ERROR: VERSION file not found"
            exit 1
          fi
          VERSION_CONTENT=$(cat VERSION)
          if ! [[ "$VERSION_CONTENT" =~ ^v[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "ERROR: VERSION file does not match semver pattern (^v[0-9]+\.[0-9]+\.[0-9]+$)"
            echo "Found: $VERSION_CONTENT"
            exit 1
          fi
          echo "VERSION file is valid: $VERSION_CONTENT"
